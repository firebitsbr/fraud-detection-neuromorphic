# Docker Compose - Detecção de Fraude Neuromórfica
#
# Descrição: Orquestração de 3 serviços containerizados para sistema completo
#            de detecção de fraude: API (FastAPI), Notebooks (JupyterLab) e
#            Interface Web (Streamlit). Todos expostos apenas em localhost.
#
# Autor: Mauro Risonho de Paula Assumpção
# Email: mauro.risonho@gmail.com
# LinkedIn: https://www.linkedin.com/in/maurorisonho
# GitHub: https://github.com/maurorisonho
# Data de Criação: Dezembro 2025
# Licença: MIT

version: '3.8'

services:
  # ========== FASTAPI REST API ==========
  fraud-api:
    build:
      context: .
      dockerfile: docker/Dockerfile.api
    container_name: neuromorphic-fraud-api
    ports:
      - "127.0.0.1:8000:8000"  # API REST
    environment:
      - PYTHONUNBUFFERED=1
      - LOG_LEVEL=INFO
    volumes:
      - ./src:/app/src:ro
    networks:
      - neuromorphic-net
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import requests; requests.get('http://localhost:8000/api/v1/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    labels:
      - "com.neuromorphic.service=api"
      - "com.neuromorphic.project=01_fraud_neuromorphic"

  # ========== JUPYTER LAB ==========
  jupyter-lab:
    build:
      context: .
      dockerfile: docker/Dockerfile.jupyter
    container_name: neuromorphic-jupyter
    ports:
      - "127.0.0.1:8888:8888"  # Jupyter Lab
    environment:
      - JUPYTER_ENABLE_LAB=yes
      - PYTHONUNBUFFERED=1
    volumes:
      - ./notebooks:/workspace/notebooks
      - ./src:/workspace/src
      - ./data:/workspace/data
      - ./tests:/workspace/tests
    networks:
      - neuromorphic-net
    restart: unless-stopped
    labels:
      - "com.neuromorphic.service=jupyter"
      - "com.neuromorphic.project=01_fraud_neuromorphic"

  # ========== WEB INTERFACE (STREAMLIT) ==========
  web-interface:
    build:
      context: .
      dockerfile: docker/Dockerfile.streamlit
    container_name: neuromorphic-web
    ports:
      - "127.0.0.1:8501:8501"  # Streamlit UI
    environment:
      - API_URL=http://fraud-api:8000
      - STREAMLIT_SERVER_PORT=8501
      - STREAMLIT_SERVER_ADDRESS=0.0.0.0
    volumes:
      - ./web:/app/web:ro
    depends_on:
      - fraud-api
    networks:
      - neuromorphic-net
    restart: unless-stopped
    labels:
      - "com.neuromorphic.service=web"
      - "com.neuromorphic.project=01_fraud_neuromorphic"

networks:
  neuromorphic-net:
    driver: bridge
    name: neuromorphic-network

volumes:
  data:
    name: neuromorphic-data
